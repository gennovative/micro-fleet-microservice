{"version":3,"sources":["app/rpc/RpcHandlerBase.ts"],"names":[],"mappings":";AAAA,0CAAuC;AAyBvC;IAYC,YAAsB,aAAmC;QAAnC,kBAAa,GAAb,aAAa,CAAsB;IACzD,CAAC;IATD,IAAW,IAAI;QACd,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC;IACnB,CAAC;IAED,IAAW,IAAI,CAAC,GAAW;QAC1B,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;IAClB,CAAC;IAMS,iBAAiB,CAAC,MAAc,EAAE,KAAsB,EAAE,UAA6B;QAChG,yCAAyC;QACzC,IAAI,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,OAAO,CAAM,KAAK,CAAC,CAAC;QACtD,aAAK,CAAC,cAAc,CAAC,QAAQ,EAAE,6BAA6B,KAAK,GAAG,CAAC,CAAC;QAEtE,IAAI,QAAQ,GAAG,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC;QAElD,0EAA0E;QAC1E,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;YACf,QAAQ,GAAG,CAAC,UAAU,GAAG,UAAU,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC,CAAC;QACvD,CAAC;QAED,aAAK,CAAC,cAAc,CAAC,QAAQ,EAAE,kCAAkC,CAAC,CAAC;QAEnE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAChC,CAAC;IAES,cAAc,CAAC,SAAS,EAAE,IAAI,EAAE,OAAe;QACxD,MAAM,CAAC;YACN,SAAS;YACT,IAAI,EAAE,IAAI,CAAC,KAAK;YAChB,EAAE,EAAE,OAAO;YACX,IAAI;SACJ,CAAC;IACH,CAAC;CACD;AAzCD,wCAyCC","file":"RpcHandlerBase.js","sourcesContent":["import { Guard } from '../utils/Guard';\r\nimport { IDependencyContainer } from '../utils/DependencyContainer';\r\nimport { IRpcRequest, IRpcResponse } from './RpcModels';\r\n\r\n// Based on ES6 native Promise definition\r\nexport type PromiseResolveFn = (value?: any | PromiseLike<any>) => void;\r\nexport type PromiseRejectFn = (reason?: any) => void;\r\n\r\nexport type RpcControllerFunction = (request: IRpcRequest, resolve: PromiseResolveFn, reject: PromiseRejectFn) => void;\r\nexport type RpcActionFactory = (controller) => RpcControllerFunction;\r\n\r\nexport interface IRpcHandler {\r\n\t/**\r\n\t * A name used in \"from\" and \"to\" request property.\r\n\t */\r\n\tname: string;\r\n\r\n\t/**\r\n\t * Waits for incoming request, resolves an instance with `dependencyIdentifier`,\r\n\t * calls instance's `action` method. If `customAction` is specified, \r\n\t * calls instance's `customAction` instead.\r\n\t */\r\n\thandle(action: string, dependencyIdentifier: string | symbol, actionFactory?: RpcActionFactory);\r\n}\r\n\r\nexport abstract class RpcHandlerBase {\r\n\r\n\tprotected _name: string;\r\n\r\n\tpublic get name(): string {\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tpublic set name(val: string) {\r\n\t\tthis._name = val;\r\n\t}\r\n\r\n\tconstructor(protected _depContainer: IDependencyContainer) {\r\n\t}\r\n\t\r\n\r\n\tprotected resolveActionFunc(action: string, depId: string | symbol, actFactory?: RpcActionFactory): RpcControllerFunction {\r\n\t\t// Attempt to resolve controller instance\r\n\t\tlet instance = this._depContainer.resolve<any>(depId);\r\n\t\tGuard.assertIsTruthy(instance, `Cannot resolve dependency ${depId}!`);\r\n\r\n\t\tlet actionFn = (action ? instance[action] : null);\r\n\t\t\r\n\t\t// If default action is not available, attempt to get action from factory.\r\n\t\tif (!actionFn) {\r\n\t\t\tactionFn = (actFactory ? actFactory(instance) : null);\r\n\t\t}\r\n\r\n\t\tGuard.assertIsTruthy(instance, `Specified action does not exist!`);\r\n\r\n\t\treturn actionFn.bind(instance);\r\n\t}\r\n\r\n\tprotected createResponse(isSuccess, data, replyTo: string): IRpcResponse {\r\n\t\treturn {\r\n\t\t\tisSuccess,\r\n\t\t\tfrom: this._name,\r\n\t\t\tto: replyTo,\r\n\t\t\tdata\r\n\t\t};\r\n\t}\r\n}\r\n"]}