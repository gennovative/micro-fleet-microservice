{"version":3,"sources":["app/rpc/HttpRpcCaller.ts"],"names":[],"mappings":";;;;;;;;;;AAGA,2CAA2C;AAG3C,0CAAuC;AAEvC,sEAAwF;AAExF,mDAA4D;AAS5D,IAAa,aAAa,GAA1B,mBACG,SAAQ,6BAAa;IAMvB;QACC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC;IAC9B,CAAC;IAED,IAAW,OAAO;QACjB,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;IACtB,CAAC;IAED,IAAW,OAAO,CAAC,GAAW;QAC7B,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;IACrB,CAAC;IAEM,IAAI,CAAC,UAAkB,EAAE,MAAc,EAAE,KAAU;QACzD,aAAK,CAAC,aAAa,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;QAC9C,aAAK,CAAC,aAAa,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QACtC,aAAK,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,EAAE,uBAAuB,CAAC,CAAC;QAE7D,MAAM,CAAC,IAAI,OAAO,CAAe,CAAC,OAAO,EAAE,MAAM;YAChD,IAAI,OAAO,GAAG;gBACb,MAAM,EAAE,MAAM;gBACd,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,IAAI,UAAU,IAAI,MAAM,EAAE;gBAC/C,IAAI,EAAE,KAAK;gBACX,IAAI,EAAE,IAAI,CAAC,6CAA6C;aACxD,CAAC;YAEF,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QACpC,CAAC,CAAC,CAAC;IACJ,CAAC;CACD,CAAA;AApCY,aAAa;IADzB,gCAAU,EAAE;;GACA,aAAa,CAoCzB;AApCY,sCAAa","file":"HttpRpcCaller.js","sourcesContent":["import { EventEmitter } from 'events';\r\n\r\nimport * as uuid from 'uuid';\r\nimport * as request from 'request-promise';\r\n\r\nimport * as ex from '../microservice/Exceptions';\r\nimport { Guard } from '../utils/Guard';\r\nimport { Types as T } from '../constants/Types';\r\nimport { injectable, inject, IDependencyContainer } from '../utils/DependencyContainer';\r\nimport { IMessageBrokerAdapter, MessageHandleFunction, IMessage } from '../adapters/MessageBrokerAdapter';\r\nimport { RpcCallerBase, IRpcCaller } from './RpcCallerBase';\r\nimport { IRpcRequest, IRpcResponse } from './RpcModels';\r\n\r\n\r\nexport interface IHttpRpcCaller extends IRpcCaller {\r\n\tbaseUrl: string;\r\n}\r\n\r\n@injectable()\r\nexport class HttpRpcCaller\r\n\t\t\textends RpcCallerBase\r\n\t\t\timplements IHttpRpcCaller {\r\n\r\n\tprivate _baseUrl: string;\r\n\tprivate _requestMaker: (options) => Promise<any>;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._requestMaker = request;\r\n\t}\r\n\r\n\tpublic get baseUrl(): string {\r\n\t\treturn this._baseUrl;\r\n\t}\r\n\r\n\tpublic set baseUrl(val: string) {\r\n\t\tthis._baseUrl = val;\r\n\t}\r\n\r\n\tpublic call(moduleName: string, action: string, param: any): Promise<IRpcResponse> {\r\n\t\tGuard.assertDefined('moduleName', moduleName);\r\n\t\tGuard.assertDefined('action', action);\r\n\t\tGuard.assertIsTruthy(this._baseUrl, 'Base URL must be set!');\r\n\r\n\t\treturn new Promise<IRpcResponse>((resolve, reject) => {\r\n\t\t\tlet options = {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turi: `${this._baseUrl}/${moduleName}/${action}`,\r\n\t\t\t\tbody: param,\r\n\t\t\t\tjson: true // Automatically stringifies the body to JSON\r\n\t\t\t};\r\n\r\n\t\t\treturn this._requestMaker(options);\r\n\t\t});\r\n\t}\r\n}"]}